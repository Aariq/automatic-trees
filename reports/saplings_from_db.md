# Extract sapling transition tables


# Pulling trees

``` r
source(here::here("R", "query_tables_db_fxns.R"))
```

    Loading required package: DBI

    Warning: package 'DBI' was built under R version 4.3.2

    Warning: package 'dplyr' was built under R version 4.3.2


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
source(here::here("R", "query_saplings.R"))

con <- connect_to_tables(here::here("data", "db", "foresttime-to-share.duckdb"))
```

``` r
saplings_ct <- query_saplings(con, 
                              conditions = create_conditions(
                                STATECD == 9
                              ))
```

    Joining with `by = join_by(PLOT_COMPOSITE_ID, INVYR)`

``` r
knitr::kable(head(saplings_ct, 40))
```

| PLOT_COMPOSITE_ID | PLOT | COUNTYCD | STATECD |       PLT_CN | INVYR | PREV_INVYR | CYCLE | live_sapling | new_sapling | sapling_sapling | sapling_tree | sapling_dead | sapling_removed | sapling_not_sampled | sapling_missing_data | sapling_vanishes_next_year | PREV_live_sapling | sapling_vanished | presumed_dead | timespan | sapling_sapling_prop | sapling_tree_prop | sapling_removed_prop | presumed_dead_prop | sapling_not_sampled_prop | sapling_missing_data_prop |
|:------------------|-----:|---------:|--------:|-------------:|------:|-----------:|------:|-------------:|------------:|----------------:|-------------:|-------------:|----------------:|--------------------:|---------------------:|---------------------------:|------------------:|-----------------:|--------------:|---------:|---------------------:|------------------:|---------------------:|-------------------:|-------------------------:|--------------------------:|
| 9_1_11_665        |  665 |       11 |       9 | 3.738510e+14 |  2017 |       2011 |     7 |            0 |           0 |               0 |            0 |            0 |               0 |                   5 |                    0 |                          0 |                 5 |                0 |             0 |        6 |            0.0000000 |         0.0000000 |                    0 |          0.0000000 |                1.0000000 |                         0 |
| 9_1_11_67         |   67 |       11 |       9 | 5.036498e+14 |  2019 |       2012 |     7 |           12 |           4 |               8 |            0 |            0 |               0 |                   0 |                    0 |                         12 |                 8 |                0 |             0 |        7 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_13_410        |  410 |       13 |       9 | 1.689309e+14 |  2010 |       2006 |     6 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        4 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_13_410        |  410 |       13 |       9 | 2.457948e+14 |  2015 |       2010 |     7 |            2 |           1 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          2 |                 1 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_13_441        |  441 |       13 |       9 | 2.209135e+14 |  2011 |       2006 |     6 |            4 |           1 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_13_441        |  441 |       13 |       9 | 3.040319e+14 |  2016 |       2011 |     7 |            2 |           1 |               1 |            1 |            2 |               0 |                   0 |                    0 |                          2 |                 4 |                0 |             2 |        5 |            0.2500000 |         0.2500000 |                    0 |          0.5000000 |                0.0000000 |                         0 |
| 9_1_13_69         |   69 |       13 |       9 | 3.040319e+14 |  2016 |       2010 |     7 |            7 |           2 |               5 |            0 |            1 |               0 |                   0 |                    0 |                          7 |                 6 |                0 |             1 |        6 |            0.8333333 |         0.0000000 |                    0 |          0.1666667 |                0.0000000 |                         0 |
| 9_1_1_423         |  423 |        1 |       9 | 2.209135e+14 |  2011 |       2007 |     6 |            4 |           0 |               4 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             0 |        4 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_1_423         |  423 |        1 |       9 | 4.455257e+14 |  2018 |       2011 |     7 |            3 |           0 |               3 |            0 |            1 |               0 |                   0 |                    0 |                          3 |                 4 |                0 |             1 |        7 |            0.7500000 |         0.0000000 |                    0 |          0.2500000 |                0.0000000 |                         0 |
| 9_1_3_316         |  316 |        3 |       9 | 1.689309e+14 |  2010 |       2006 |     6 |            1 |           0 |               1 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             1 |        4 |            0.5000000 |         0.0000000 |                    0 |          0.5000000 |                0.0000000 |                         0 |
| 9_1_3_316         |  316 |        3 |       9 | 3.040319e+14 |  2016 |       2010 |     7 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          1 |                 1 |                0 |             0 |        6 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_3_425         |  425 |        3 |       9 | 5.036498e+14 |  2019 |       2012 |     7 |            2 |           0 |               2 |            1 |            5 |               0 |                   6 |                    0 |                          2 |                14 |                0 |             5 |        7 |            0.1428571 |         0.0714286 |                    0 |          0.3571429 |                0.4285714 |                         0 |
| 9_1_5_123         |  123 |        5 |       9 | 1.689310e+14 |  2010 |       2005 |     6 |            2 |           0 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_5_123         |  123 |        5 |       9 | 2.457948e+14 |  2015 |       2010 |     7 |            2 |           0 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          2 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_5_187         |  187 |        5 |       9 | 5.036498e+14 |  2019 |       2012 |     7 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          1 |                 1 |                0 |             0 |        7 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_5_449         |  449 |        5 |       9 | 2.209134e+14 |  2011 |       2006 |     6 |            3 |           0 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_5_449         |  449 |        5 |       9 | 3.738509e+14 |  2017 |       2011 |     7 |            2 |           0 |               2 |            0 |            1 |               0 |                   0 |                    0 |                          2 |                 3 |                0 |             1 |        6 |            0.6666667 |         0.0000000 |                    0 |          0.3333333 |                0.0000000 |                         0 |
| 9_1_5_479         |  479 |        5 |       9 | 2.470504e+14 |  2012 |       2007 |     6 |            9 |           1 |               8 |            0 |            0 |               0 |                   2 |                    0 |                          0 |                10 |                0 |             0 |        5 |            0.8000000 |         0.0000000 |                    0 |          0.0000000 |                0.2000000 |                         0 |
| 9_1_9_64          |   64 |        9 |       9 | 1.689309e+14 |  2010 |       2006 |     6 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        4 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_11_185        |  185 |       11 |       9 | 2.209135e+14 |  2011 |       2007 |     6 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        4 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_11_185        |  185 |       11 |       9 | 3.738510e+14 |  2017 |       2011 |     7 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          1 |                 1 |                0 |             0 |        6 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_11_218        |  218 |       11 |       9 | 1.689308e+14 |  2010 |       2006 |     6 |            6 |           2 |               4 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             0 |        4 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_11_218        |  218 |       11 |       9 | 3.040319e+14 |  2016 |       2010 |     7 |            5 |           0 |               5 |            0 |            0 |               0 |                   1 |                    0 |                          5 |                 6 |                0 |             0 |        6 |            0.8333333 |         0.0000000 |                    0 |          0.0000000 |                0.1666667 |                         0 |
| 9_1_11_41         |   41 |       11 |       9 | 1.449887e+14 |  2009 |       2004 |     6 |            4 |           0 |               4 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_11_41         |   41 |       11 |       9 | 1.682491e+14 |  2014 |       2009 |     7 |            3 |           0 |               3 |            1 |            0 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             0 |        5 |            0.7500000 |         0.2500000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_11_41         |   41 |       11 |       9 | 7.193933e+14 |  2021 |       2014 |     8 |            0 |           0 |               0 |            0 |            0 |               3 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        7 |            0.0000000 |         0.0000000 |                    1 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_11_6          |    6 |       11 |       9 | 1.416711e+13 |  2013 |       2008 |     7 |            2 |           2 |               0 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 0 |                0 |             0 |        5 |                   NA |                NA |                   NA |                 NA |                       NA |                        NA |
| 9_1_11_6          |    6 |       11 |       9 | 5.674815e+14 |  2020 |       2013 |     8 |            0 |           0 |               0 |            0 |            2 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             2 |        7 |            0.0000000 |         0.0000000 |                    0 |          1.0000000 |                0.0000000 |                         0 |
| 9_1_11_601        |  601 |       11 |       9 | 2.209135e+14 |  2011 |       2006 |     6 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_11_601        |  601 |       11 |       9 | 3.738510e+14 |  2017 |       2011 |     7 |            0 |           0 |               0 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             1 |        6 |            0.0000000 |         0.0000000 |                    0 |          1.0000000 |                0.0000000 |                         0 |
| 9_1_11_95         |   95 |       11 |       9 | 4.455257e+14 |  2018 |       2012 |     7 |            4 |           0 |               4 |            0 |            0 |               0 |                   0 |                    0 |                          4 |                 4 |                0 |             0 |        6 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_15_583        |  583 |       15 |       9 | 1.416712e+13 |  2013 |       2008 |     7 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_15_583        |  583 |       15 |       9 | 5.674815e+14 |  2020 |       2013 |     8 |            0 |           0 |               0 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             1 |        7 |            0.0000000 |         0.0000000 |                    0 |          1.0000000 |                0.0000000 |                         0 |
| 9_1_1_319         |  319 |        1 |       9 | 3.040318e+14 |  2016 |       2011 |     7 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          1 |                 1 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_1_492         |  492 |        1 |       9 | 1.449917e+14 |  2009 |       2005 |     6 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        4 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_1_492         |  492 |        1 |       9 | 1.682490e+14 |  2015 |       2009 |     7 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          1 |                 1 |                0 |             0 |        6 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 9_1_1_586         |  586 |        1 |       9 | 2.470504e+14 |  2012 |       2007 |     6 |            3 |           0 |               3 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             1 |        5 |            0.7500000 |         0.0000000 |                    0 |          0.2500000 |                0.0000000 |                         0 |
| 9_1_1_586         |  586 |        1 |       9 | 4.455257e+14 |  2018 |       2012 |     7 |            2 |           0 |               2 |            0 |            1 |               0 |                   0 |                    0 |                          2 |                 3 |                0 |             1 |        6 |            0.6666667 |         0.0000000 |                    0 |          0.3333333 |                0.0000000 |                         0 |
| 9_1_3_137         |  137 |        3 |       9 | 4.455257e+14 |  2018 |       2012 |     7 |            4 |           3 |               1 |            0 |            1 |               0 |                   0 |                    0 |                          4 |                 2 |                0 |             1 |        6 |            0.5000000 |         0.0000000 |                    0 |          0.5000000 |                0.0000000 |                         0 |
| 9_1_3_147         |  147 |        3 |       9 | 2.209135e+14 |  2011 |       2007 |     6 |            3 |           0 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        4 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |

``` r
dbDisconnect(con, shutdown = TRUE)
```
