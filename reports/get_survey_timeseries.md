# Pulling timeseries of surveys


``` r
source(here::here("R", "query_tables_db_fxns.R"))
```

    Loading required package: DBI

    Warning: package 'DBI' was built under R version 4.3.2

    Warning: package 'dplyr' was built under R version 4.3.2


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
con <- connect_to_tables(here::here("data", "db", "foresttime-to-share.duckdb"))
```

``` r
ct_trees <- query_tree_surveys(
  con = con,
  conditions = create_conditions(
    STATECD == 9,
    SPCD == 315,
    ANY_SPCD_FLAG == FALSE
  ),
  variables = c(
    "STATUSCD",
    "STATUSCD_CORR",
    "STATUSCD_FLAG",
    "DIA",
    "HT",
    "COND_STATUS_CD",
    "LAT",
    "LON",
    "BALIVE",
    "SICOND",
    "SISP",
    "SIBASE",
    "DSTRBCD1",
    "DSTRBYR1",
    "DSTRBCD2",
    "DSTRBYR2",
    "DSTRBCD3",
    "DSTRBYR3",
    "SDIMAX_RMRS",
    "SDI_RMRS",
    "SLOPE",
    "ASPECT",
    "CONDPROP_UNADJ",
    "RECONCILECD"
  )
)
```

    Joining with `by = join_by(TREE_COMPOSITE_ID, PLOT_COMPOSITE_ID, PLOT, SUBP, STATECD, COUNTYCD)`
    Joining with `by = join_by(TREE_COMPOSITE_ID, SPCD_CORR, TREE_CN, INVYR, STATUSCD, SPCD, CYCLE)`
    Joining with `by = join_by(PLOT_COMPOSITE_ID, PLOT, STATECD, COUNTYCD, PLT_CN, INVYR, UNITCD, CYCLE, SUBCYCLE)`
    Joining with `by = join_by(PLOT_COMPOSITE_ID, PLOT, STATECD, COUNTYCD, PLT_CN, INVYR, UNITCD, CONDID, CYCLE, SUBCYCLE)`

``` r
knitr::kable(head(ct_trees, 20))
```

| TREE_COMPOSITE_ID | PLOT_COMPOSITE_ID | SPCD | PLOT | SUBP | COUNTYCD | STATECD |       PLT_CN | INVYR | CYCLE | MEASYEAR |      TREE_CN |      COND_CN | CONDID | STATUSCD | STATUSCD_CORR | STATUSCD_FLAG | DIA |  HT | COND_STATUS_CD |      LAT |       LON |   BALIVE | SICOND | SISP | SIBASE | DSTRBCD1 | DSTRBYR1 | DSTRBCD2 | DSTRBYR2 | DSTRBCD3 | DSTRBYR3 | SDIMAX_RMRS | SDI_RMRS | SLOPE | ASPECT | CONDPROP_UNADJ | RECONCILECD |
|:------------------|:------------------|-----:|-----:|-----:|---------:|--------:|-------------:|------:|------:|---------:|-------------:|-------------:|-------:|---------:|--------------:|:--------------|----:|----:|---------------:|---------:|----------:|---------:|-------:|-----:|-------:|---------:|---------:|---------:|---------:|---------:|:---------|:------------|:---------|------:|-------:|---------------:|:------------|
| 9_1_5_663_2_1     | 9_1_5_663         |  315 |  663 |    2 |        5 |       9 | 5.591710e+13 |  2003 |     5 |     2003 | 5.591716e+13 | 5.591710e+13 |      1 |        1 |             1 | FALSE         | 1.8 |  21 |              1 | 41.76155 | -73.40392 |  72.6320 |     67 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    20 |    137 |       1.000000 | NA          |
| 9_1_5_20_4_5      | 9_1_5_20          |  315 |   20 |    4 |        5 |       9 | 5.592072e+13 |  2004 |     5 |     2003 | 6.217067e+13 | 6.217060e+13 |      1 |        1 |             1 | FALSE         | 6.8 |  43 |              1 | 41.98612 | -73.26200 | 172.3258 |     64 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    17 |     63 |       0.727289 | NA          |
| 9_1_5_611_2_1     | 9_1_5_611         |  315 |  611 |    2 |        5 |       9 | 5.592176e+13 |  2004 |     5 |     2003 | 6.217167e+13 | 6.217163e+13 |      1 |        1 |             1 | FALSE         | 1.4 |  17 |              1 | 41.69320 | -73.46460 |  59.6033 |     66 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    20 |    160 |       0.750000 | NA          |
| 9_1_1_658_4_3     | 9_1_1_658         |  315 |  658 |    4 |        1 |       9 | 7.433093e+13 |  2006 |     5 |     2006 | 7.433101e+13 | 7.433094e+13 |      1 |        1 |             1 | FALSE         | 5.4 |  32 |              1 | 41.50268 | -73.50991 |  87.2997 |     76 |  806 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    13 |    250 |       1.000000 | NA          |
| 9_1_5_19_2_13     | 9_1_5_19          |  315 |   19 |    2 |        5 |       9 | 7.433224e+13 |  2006 |     5 |     2006 | 7.433227e+13 | 7.433224e+13 |      1 |        1 |             1 | FALSE         | 1.0 |  14 |              1 | 41.84992 | -73.10941 |  91.3291 |     67 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    12 |    239 |       1.000000 | NA          |
| 9_1_3_331_1_31    | 9_1_3_331         |  315 |  331 |    1 |        3 |       9 | 1.225561e+14 |  2007 |     5 |     2008 | 1.637861e+14 | 1.637421e+14 |      1 |        1 |             1 | FALSE         | 1.1 |  15 |              1 | 42.03146 | -72.73370 | 205.1505 |     76 |  129 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |     0 |      0 |       1.000000 | NA          |
| 9_1_5_101_1_23    | 9_1_5_101         |  315 |  101 |    1 |        5 |       9 | 1.225560e+14 |  2007 |     5 |     2008 | 1.637870e+14 | 1.637429e+14 |      1 |        1 |             1 | FALSE         | 4.6 |  38 |              1 | 41.91447 | -73.01828 |  83.4910 |     75 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    11 |    130 |       1.000000 | NA          |
| 9_1_5_676_3_10    | 9_1_5_676         |  315 |  676 |    3 |        5 |       9 | 1.225561e+14 |  2007 |     5 |     2008 | 1.637871e+14 | 1.637430e+14 |      1 |        1 |             1 | FALSE         | 6.2 |  42 |              1 | 41.98309 | -73.14794 | 168.9822 |     67 |  541 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    20 |    240 |       0.880501 | NA          |
| 9_1_5_20_4_5      | 9_1_5_20          |  315 |   20 |    4 |        5 |       9 | 1.197743e+14 |  2008 |     6 |     2008 | 2.075015e+14 | 2.075014e+14 |      1 |        1 |             1 | FALSE         | 7.0 |  50 |              1 | 41.98612 | -73.26200 | 186.9985 |     64 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    17 |     75 |       0.727289 | NA          |
| 9_1_5_611_2_1     | 9_1_5_611         |  315 |  611 |    2 |        5 |       9 | 1.197743e+14 |  2008 |     6 |     2008 | 2.075021e+14 | 2.075021e+14 |      1 |        1 |             1 | FALSE         | 1.4 |  17 |              1 | 41.69320 | -73.46460 |  71.6267 |     69 |  318 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    20 |    172 |       0.750000 | NA          |
| 9_1_5_663_2_1     | 9_1_5_663         |  315 |  663 |    2 |        5 |       9 | 1.197743e+14 |  2008 |     6 |     2008 | 2.075021e+14 | 2.075020e+14 |      1 |        1 |             1 | FALSE         | 2.8 |  28 |              1 | 41.76155 | -73.40392 |  84.6055 |     67 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    20 |    137 |       1.000000 | NA          |
| 9_1_1_658_4_3     | 9_1_1_658         |  315 |  658 |    4 |        1 |       9 | 1.689310e+14 |  2010 |     6 |     2010 | 2.421539e+14 | 2.421539e+14 |      1 |        0 |             0 | FALSE         |  NA |  NA |              5 | 41.50268 | -73.50991 |       NA |     NA |   NA |     NA |       NA |       NA |       NA |       NA |       NA | NA       | NA          | NA       |    NA |     NA |       1.000000 | 9           |
| 9_1_5_19_2_13     | 9_1_5_19          |  315 |   19 |    2 |        5 |       9 | 1.689309e+14 |  2010 |     6 |     2010 | 2.421544e+14 | 2.421544e+14 |      1 |        1 |             1 | FALSE         | 1.1 |  15 |              1 | 41.84992 | -73.10941 |  86.5077 |     67 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    12 |    239 |       1.000000 | NA          |
| 9_1_3_331_1_31    | 9_1_3_331         |  315 |  331 |    1 |        3 |       9 | 2.470504e+14 |  2012 |     6 |     2012 | 1.883703e+14 | 1.883703e+14 |      1 |        1 |             1 | FALSE         | 1.4 |  17 |              1 | 42.03146 | -72.73370 | 227.7307 |     76 |  129 |     50 |       52 |     2011 |       51 |     2011 |        0 | NA       | NA          | NA       |     0 |      0 |       1.000000 | NA          |
| 9_1_5_101_1_23    | 9_1_5_101         |  315 |  101 |    1 |        5 |       9 | 2.470504e+14 |  2012 |     6 |     2012 | 1.883712e+14 | 1.883712e+14 |      1 |        2 |             2 | FALSE         |  NA |  NA |              1 | 41.91447 | -73.01828 |  53.0556 |     75 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    11 |    130 |       1.000000 | NA          |
| 9_1_5_20_4_5      | 9_1_5_20          |  315 |   20 |    4 |        5 |       9 | 1.416703e+13 |  2013 |     7 |     2013 | 2.551678e+14 | 2.551677e+14 |      1 |        2 |             2 | FALSE         |  NA |  NA |              1 | 41.98612 | -73.26200 | 193.2505 |     64 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    17 |     75 |       0.728449 | NA          |
| 9_1_5_611_2_1     | 9_1_5_611         |  315 |  611 |    2 |        5 |       9 | 1.416708e+13 |  2013 |     7 |     2014 | 2.551693e+14 | 2.551693e+14 |      1 |        0 |             0 | FALSE         |  NA |  NA |              5 | 41.69320 | -73.46460 |       NA |     NA |   NA |     NA |       NA |       NA |       NA |       NA |       NA | NA       | NA          | NA       |    NA |     NA |       1.000000 | 9           |
| 9_1_5_663_2_1     | 9_1_5_663         |  315 |  663 |    2 |        5 |       9 | 1.416713e+13 |  2013 |     7 |     2014 | 2.551712e+14 | 2.551712e+14 |      1 |        0 |             0 | FALSE         |  NA |  NA |              5 | 41.76155 | -73.40392 |       NA |     NA |   NA |     NA |       NA |       NA |       NA |       NA |       NA | NA       | NA          | NA       |    NA |     NA |       1.000000 | 9           |
| 9_1_3_200_3_10    | 9_1_3_200         |  315 |  200 |    3 |        3 |       9 | 2.457948e+14 |  2015 |     7 |     2015 | 3.522374e+14 | 3.522374e+14 |      2 |        1 |             1 | FALSE         | 5.3 |  34 |              1 | 41.93352 | -72.86271 |  44.6569 |     70 |  541 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    46 |     90 |       0.250000 | NA          |
| 9_1_5_19_2_13     | 9_1_5_19          |  315 |   19 |    2 |        5 |       9 | 2.457948e+14 |  2015 |     7 |     2015 | 3.522375e+14 | 3.522375e+14 |      1 |        1 |             1 | FALSE         | 1.3 |  17 |              1 | 41.84992 | -73.10941 |  92.9804 |     67 |  833 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | NA          | NA       |    12 |    239 |       1.000000 | NA          |

``` r
dbDisconnect(con, shutdown = TRUE)
```
